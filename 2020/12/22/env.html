<!DOCTYPE html> <html lang="en"> <head> <title>Env - GrahamSH-LLK</title> <meta charset="utf-8"/> <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/> <meta name="description" content=""/> <meta name="author" content=""/> <link rel="icon" href="/assets/images/logo.svg"/> <meta property="og:type" content="website"/> <meta property="og:url" content="https://grahamsh-llk.github.io/2020/12/22/env.html"/> <meta property="og:title" content='Env'/> <meta property="og:description" content=""/> <meta property="og:site_name" content="GrahamSH-LLK"/> <meta property="og:locale" content="en_US"/> <meta property="og:image:type" content="image/png"/> <meta property="og:image:width" content="384"/> <meta property="og:image:height" content="384"/> <meta property="og:image:alt" content="GrahamSH-LLK logo /"/> <meta name="twitter:card" content="summary"/> <meta name="twitter:url" content="https://grahamsh-llk.github.io/2020/12/22/env.html"/> <meta name="twitter:title" content='Env - GrahamSH-LLK'/> <meta name="twitter:description" content=""/> <meta name="twitter:image" content="https://grahamsh-llk.github.io/assets/images/icon-square.png"/> <meta name="twitter:image:alt" content="GrahamSH-LLK logo"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" crossorigin/> <link rel="stylesheet" href="/assets/css/base.css"/> <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.5.1,npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js,npm/@iconify/iconify@1.0.7,npm/bowser@2.11.0" crossorigin></script> <script async src="/assets/js/base.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-MM3W8KX6FZ"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MM3W8KX6FZ");</script> </head> <body> <header> <nav class="navbar navbar-expand-md navbar-dark"> <a href="/" class="navbar-brand"> <img src="/assets/images/logo.svg" alt="Scratch Addons logo"></img> <span>GrahamSH</span> </a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsible" aria-controls="collapsible" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <div class="collapse navbar-collapse" id="collapsible"> <ul class="navbar-nav ml-md-auto"> <li class="nav-item"><a class="nav-link" href="/blog">Blog</a></li> <li class="nav-item"><a class="nav-link" href="/contact">Contact</a></li> <li class="nav-item"><a class="nav-link" href="/about">About</a></li> </ul> </div> </nav> </header> <main><h1>Env</h1> <div class="container"> <a href="/blog"><span class="iconify mr-1" data-icon="bi:arrow-left" data-inline="false"></span>Back to Blog</a> <p class="mt-2">22 Dec 2020 - GrahamSH</p> <p>The other day, I decided to make a setup script for wasteof.money. If you don’t know what wasteof.money is, check it out at dev.wasteof.money! To start, I wanted to write to .env. The script I wrote for that simply wrote to .env using fs.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="dl">"</span><span class="s2">.env</span><span class="dl">"</span><span class="p">,</span> <span class="s2">`DB_URL=`</span><span class="p">,</span> <span class="dl">"</span><span class="s2">utf8</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Got it!</span><span class="dl">"</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div> <p>Then, I wanted to have the user be able to put in inputs. For that, I used the prompts package from NPM. My code now looked like this:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">prompts</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">prompts</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>
<span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">prompts</span><span class="p">([</span>
    <span class="p">{</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">message</span><span class="p">:</span>
        <span class="dl">"</span><span class="s2">What is your MongoDB URL? (If you are using MongoDB Atlas, you can keep the &lt;&gt; values)</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">What port should the site run on?</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">initial</span><span class="p">:</span> <span class="mi">8080</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">]);</span>

  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span>
    <span class="dl">"</span><span class="s2">.env</span><span class="dl">"</span><span class="p">,</span>
    <span class="s2">`DB_URL=</span><span class="p">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">url</span>
      <span class="err">\</span><span class="nx">nLISTEN_PORT</span><span class="o">=</span><span class="nx">$</span><span class="p">{</span><span class="nx">response</span><span class="p">.</span><span class="nx">port</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">utf8</span><span class="dl">"</span><span class="p">,</span>
    <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Your settings have been written to .env!</span><span class="dl">"</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Run npm run serve to start the server or npm run dev to start it with nodemon.</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">})();</span>
</code></pre></div></div> <p>At this point, the code was working, but it still didn’t satisfy me. I wanted the user to be able to input a password and have that switched out with the <password> value from MongoDB Atlas.</password></p> <p>I decided that it should also ask the user if they are using local, or Atlas. My final version looked like this.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">prompts</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">prompts</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">dotenv</span><span class="dl">"</span><span class="p">).</span><span class="nx">config</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">LISTEN_PORT</span> <span class="o">||</span> <span class="mi">8080</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_URL</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">localhost/social</span><span class="dl">"</span><span class="p">;</span>

<span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">prompts</span><span class="p">([</span>
    <span class="p">{</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">What is your MongoDB URL? (If you are using MongoDB Atlas, you can keep the &lt;&gt; values)</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">initial</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">select</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Pick a hosting type</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">choices</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">MongoDB Atlas</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">description</span><span class="p">:</span> <span class="dl">"</span><span class="s2">MongoDB Atlas cloud hosting</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">value</span><span class="p">:</span> <span class="dl">"</span><span class="s2">atlas</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Local MongoDB</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">value</span><span class="p">:</span> <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">description</span><span class="p">:</span> <span class="dl">"</span><span class="s2">A local MongoDB instance</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">],</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">type</span><span class="p">:</span> <span class="p">(</span><span class="nx">prev</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">prev</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">atlas</span><span class="dl">"</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">password</span><span class="dl">"</span> <span class="p">:</span> <span class="kc">null</span><span class="p">),</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">What is your MongoDB Password?</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">What port should the site run on?</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">initial</span><span class="p">:</span> <span class="nx">port</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">]);</span>

  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span>
    <span class="dl">"</span><span class="s2">.env</span><span class="dl">"</span><span class="p">,</span>
    <span class="s2">`DB_URL=</span><span class="p">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;password&gt;</span><span class="dl">"</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">password</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;dbname&gt;</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">social</span><span class="dl">"</span><span class="p">)}</span><span class="s2">\nLISTEN_PORT=</span><span class="p">${</span>
      <span class="nx">response</span><span class="p">.</span><span class="nx">port</span>
    <span class="p">}</span><span class="s2">`</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">utf8</span><span class="dl">"</span><span class="p">,</span>
    <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Your settings have been written to .env!</span><span class="dl">"</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Run npm run serve to start the server or npm run dev to start it with nodemon.</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">})();</span>
</code></pre></div></div> <div class="row"> <div class="col text-left"> <a href="/2020/11/29/test">« Test</a> </div> <div class="col text-right"> </div> </div> </div> <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.4.1/build/styles/github.min.css"> <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.4.1/build/highlight.min.js"></script> <script>hljs.initHighlightingOnLoad();</script> </main> <a id="dark-toggle" class="btn" title="Click to toggle the dark theme." aria-label="Dark theme switch button" data-toggle="tooltip" data-placement="left"></a> <footer class="footer"> <section><a class="btn btn-primary" style="background-color: #333333" href="https://github.com/GrahamSH-LLK" role="button"> <span class="iconify" data-icon="ant-design:github-filled" data-inline="false"></span> </a><p>© 2020 @GrahamSH</p></section> </footer> </body> </html>